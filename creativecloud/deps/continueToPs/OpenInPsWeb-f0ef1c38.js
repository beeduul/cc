function E(g,l,h,f){return new Promise((y,r)=>{import("./proxy-c6cbd35c.js").then(u=>{const e=new URL(g);e.pathname="embed-content-proxy.html";const c=e.searchParams;c.append("origin",document.location.origin),e.search=c.toString();const n=document.createElement("iframe");if(!n){r(new Error("could not create proxy iframe"));return}n.style.display="none",window.addEventListener("message",async a=>{if(a.source!==n.contentWindow)return;if(a.data==="psweb-embed-content-proxy-denied")r(new Error("proxy denied"));else if(a.data!=="psweb-embed-content-proxy-ready")return;if(!n.contentWindow){r(new Error("proxyFrame.contentWindow null"));return}const d=u.getProxy(n.contentWindow,window,e.origin),o=`manifest_${(Math.random()+1).toString(36).substring(7)}`,m=[],i=h.map((t,$)=>{const s=`${o}_imageData${$}/${t.filename}`;try{m.push(d.set(s,t.imageData))}catch(R){r(new Error(`proxy.set failed when writing ${s}, ${R}`))}return{filename:t.filename,imagePath:s}});await Promise.all(m);const p={inputs:[{href:i[0].imagePath,storage:"idb"}],options:{actionJSON:f}};i.slice(1).length>0&&(p.options.additionalImages=i.slice(1).map(t=>({href:t.imagePath,storage:"idb"})));const P={version:2,filename:l,data:p};await d.set(o,JSON.stringify(P));const w={proxyid:o,proxytype:"manifest"};e.searchParams.has("PR")&&(w.PR=e.searchParams.get("PR"));const x=new URLSearchParams(w),b=new URL(`${e.origin}/id?${x}`);(window.top??window).location.assign(b),n.remove(),y()}),n.src=e.href,document.body.appendChild(n)})})}export{E as openInPsWeb};
